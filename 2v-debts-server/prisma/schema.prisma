// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "generated/prisma/client"
  url      = env("DATABASE_URL")
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  debts       Debt[]
  friendships Friendship[] @relation("UserFriendships")
  friends     Friendship[] @relation("UserFriends")
  movements   Movement[]
  creditor    Debt[]       @relation("UserCreditor")
  debtor      Debt[]       @relation("UserDebtor")

  @@map("users")
}

enum DebtStatus {
  PENDING
  COMPLETED
  DELETED
}

model Debt {
  id          String    @id @default(uuid())
  title       String
  description String
  total_debt  Float
  total_paid  Float     @default(0)
  status      DebtStatus  @default(PENDING)
  dueDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  creditorId  String
  creditor_id User       @relation("UserCreditor", fields: [creditorId], references: [id])
  debtorId    String
  debtor_id   User       @relation("UserDebtor", fields: [debtorId], references: [id])
  movements   Movement[]

  users User[]

  @@map("debts")
}

model Friendship {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId    String
  user_id   User   @relation("UserFriendships", fields: [userId], references: [id])
  friendId  String
  friend_id User   @relation("UserFriends", fields: [friendId], references: [id])

  @@unique([userId, friendId])
  @@map("friendships")
}

enum MovementType {
  CREATION
  PAYMENT
  CANCELLATION
}

model Movement {
  id              String    @id @default(uuid())
  type            MovementType    @default(CREATION)
  amount          Float
  previous_amount Float
  new_amount      Float
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?

  user_id String
  user    User   @relation(fields: [user_id], references: [id])
  debt_id String
  debt    Debt   @relation(fields: [debt_id], references: [id])

  @@map("movements")
}
